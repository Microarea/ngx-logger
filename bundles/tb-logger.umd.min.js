!function(e,r){"object"==typeof exports&&"undefined"!=typeof module?r(exports,require("@angular/core"),require("@angular/common/http"),require("rxjs"),require("rxjs/operators"),require("@stomp/ng2-stompjs"),require("@progress/kendo-angular-notification"),require("@angular/common"),require("@angular/forms"),require("@progress/kendo-angular-buttons"),require("@progress/kendo-angular-dropdowns"),require("@progress/kendo-angular-inputs"),require("@progress/kendo-angular-dateinputs")):"function"==typeof define&&define.amd?define("@tb/logger",["exports","@angular/core","@angular/common/http","rxjs","rxjs/operators","@stomp/ng2-stompjs","@progress/kendo-angular-notification","@angular/common","@angular/forms","@progress/kendo-angular-buttons","@progress/kendo-angular-dropdowns","@progress/kendo-angular-inputs","@progress/kendo-angular-dateinputs"],r):r(((e=e||self).tb=e.tb||{},e.tb.logger={}),e.ng.core,e.ng.common.http,e.rxjs,e.rxjs.operators,e.ng2Stompjs,e.kendoAngularNotification,e.ng.common,e.ng.forms,e.kendoAngularButtons,e.kendoAngularDropdowns,e.kendoAngularInputs,e.kendoAngularDateinputs)}(this,(function(e,r,t,o,n,i,s,a,p,c,g,u,l){"use strict";var h=function(e){this.instanceKey=e};var d=function(e,r,t){this.minutes="1",this.instanceKey=e,this.accountName=r,this.processName=t};var f=function(e,r){this.Result=e};var v,m={Info:0,Debug:1,Warn:2,Error:3,Fatal:4};m[m.Info]="Info",m[m.Debug]="Debug",m[m.Warn]="Warn",m[m.Error]="Error",m[m.Fatal]="Fatal";var y=function(){return v};var b={Trace:0,Debug:1,Warn:2,Error:3};function S(e,r){return void 0===r&&(r=b.Debug),{Message:e,Registeredappid:y().getAppId(),AccountName:localStorage.getItem("_accountname"),Subscription:localStorage.getItem("_company"),Category:"Client",Level:r}}b[b.Trace]="Trace",b[b.Debug]="Debug",b[b.Warn]="Warn",b[b.Error]="Error";var L=function(){function e(e,r,t){var n=this;this.env=e,this.http=r,this.stompService=t,this.howMany=100,this.mqConnectionState=i.StompState.CLOSED,this.mqConnectionStateObservable=new o.BehaviorSubject(i.StompState.CLOSED),this._shouldLog=function(e){return e>=n.env.logger.level},this._serverLog=function(e,r){return n._shouldLog(e)&&n.sendLog(r,e)},v=this,this.loggerUrl=this.env.logger&&this.env.logger.url,this.serverMonitorUrl=this.env.serverMonitor&&this.env.serverMonitor.url,e.stompConfig&&this.mqInit()}return e.prototype.mqInit=function(){var e=this;this.env.stompConfig&&(this.stompService.config=this.env.stompConfig,this.stompService.initAndConnect(),this.stompService.state.subscribe((function(r){e.mqConnectionState=r,e.mqConnectionStateObservable.next(r)})))},e.prototype.getAppId=function(){return this.env.logger.appId},e.prototype.getLoggerUrl=function(){return this.loggerUrl?this.loggerUrl:this.env.logger.url},e.prototype.getLoggerPostUrl=function(){return this.getLoggerUrl()+"entries/"+this.getAppId()+"/"},e.prototype.getServerMonitorUrl=function(){return this.serverMonitorUrl?this.serverMonitorUrl:this.env.serverMonitor.url},e.prototype.sendLog=function(e,r){this.http.post(this.getLoggerPostUrl(),S(e,r)).toPromise().then((function(e){}),(function(e){return!0}))},e.prototype.log=function(e){this._shouldLog(b.Trace)&&console.log("%c"+e,"color:#3daf67"),this._serverLog(b.Trace,e)},e.prototype.debug=function(e){this._shouldLog(b.Debug)&&console.log("%c"+e,"color:#0277bd"),this._serverLog(b.Debug,e)},e.prototype.warn=function(e){this._shouldLog(b.Warn)&&console.log("%c"+e,"color:#FF9633"),this._serverLog(b.Warn,e)},e.prototype.error=function(e){this._shouldLog(b.Error)&&console.error("%c"+e,"color:red"),this._serverLog(b.Error,e)},e.prototype.stat=function(e){console.log("%c"+e,"color:#884EA0"),this._serverLog(b.Trace,e)},e.prototype.getLogs=function(e){if(!e.instanceKey){var r=new f(!1,"Error - No instanceKey, no party");return o.of(r)}var i=this.getLoggerUrl()+"entries/"+e.instanceKey,s=new t.HttpParams;s=s.append("howMany",""+this.howMany),e.accountName&&(s=s.append("accountName",e.accountName)),e.subscriptionKey&&(s=s.append("subscription",e.subscriptionKey)),e.category&&(s=s.append("categories",e.category)),e.apps&&(s=s.append("apps",e.apps)),e.appTypes&&(s=s.append("appTypes",e.appTypes)),e.levels&&(s=s.append("levels",e.levels)),e.rangeDateStart&&e.rangeDateEnd&&(s=e.rangeDateStart===e.rangeDateEnd?s.append("date",e.rangeDateStart):s.append("date",e.rangeDateStart+";"+e.rangeDateEnd));var a={params:s};return this.http.get(i,a).pipe(n.catchError(this.handleError("TbLoggerService.getLogs",new f(!1,"Error - getLogs"))))},e.prototype.getApps=function(e){if(!e){var r=new f(!1,"Error - No appId, no party");return o.of(r)}var t=this.getLoggerUrl()+"apps/"+e;return this.http.get(t).pipe(n.catchError(this.handleError("TbLoggerService.getApps",new f(!1,"Error - getApps"))))},e.prototype.getAppTypes=function(e){if(!e){var r=new f(!1,"Error - No appId, no party");return o.of(r)}var t=this.getLoggerUrl()+"appTypes/"+e;return this.http.get(t).pipe(n.catchError(this.handleError("TbLoggerService.getAppTypes",new f(!1,"Error - getAppTypes"))))},e.prototype.getInstanceKey=function(){var e=this.getLoggerUrl()+"appIds";return this.http.get(e).pipe(n.catchError(this.handleError("TbLoggerService.getInstanceKey",new f(!1,"Error - getInstanceKey"))))},e.prototype.getSubscriptionKey=function(){var e=this.getLoggerUrl()+"subscriptionKeys";return this.http.get(e).pipe(n.catchError(this.handleError("TbLoggerService.getSubscriptionKey",new f(!1,"Error - getSubscriptionKey"))))},e.prototype.getCategories=function(e){if(!e){var r=new f(!1,"Error - No appId, no party");return o.of(r)}var t=this.getLoggerUrl()+"categories/"+e;return this.http.get(t).pipe(n.catchError(this.handleError("TbLoggerService.getCategories",new f(!1,"Error -  getCategories"))))},e.prototype.handleError=function(e,r){return void 0===e&&(e="operation"),function(t){return console.error(e+" failed: "+t.error),o.of(r)}},e.prototype.mqConnect=function(e){return this.stompService.subscribe(e).pipe(n.map((function(e){return JSON.parse(e.body)})))},e.prototype.mqConnected=function(){return this.stompService.connected()},e.prototype.mqDisconnect=function(){return this.stompService.disconnect()},e.prototype.getTBInfosLogs=function(e){var r=new t.HttpParams;e.accountName&&(r=r.append("accountName",""+e.accountName)),e.processName&&(r=r.append("processName",""+e.processName)),e.minutes&&(r=r.append("minute",""+e.minutes));var o={params:r},i=this.getServerMonitorUrl()+"tbServers/"+e.instanceKey;return this.http.get(i,o).pipe(n.catchError(this.handleError("TbLoggerService.getTBInfosLogs",!1)))},e.decorators=[{type:r.Injectable,args:[{providedIn:"root"}]}],e.ctorParameters=function(){return[{type:void 0,decorators:[{type:r.Inject,args:["env"]}]},{type:t.HttpClient},{type:i.StompRService}]},e.ngInjectableDef=r.ɵɵdefineInjectable({factory:function(){return new e(r.ɵɵinject("env"),r.ɵɵinject(t.HttpClient),r.ɵɵinject(i.StompRService))},token:e,providedIn:"root"}),e}();var E=function(){function e(e){this.notificationService=e}return e.prototype.show=function(e,r){void 0===r&&(r="none"),this.notificationService.show({content:e,animation:{type:"slide",duration:200},position:{horizontal:"right",vertical:"bottom"},type:{style:r,icon:!0},hideAfter:4e3})},e.decorators=[{type:r.Injectable,args:[{providedIn:"root"}]}],e.ctorParameters=function(){return[{type:s.NotificationService}]},e.ngInjectableDef=r.ɵɵdefineInjectable({factory:function(){return new e(r.ɵɵinject(s.NotificationService))},token:e,providedIn:"root"}),e}();var I=function(){function e(){}return e.forRoot=function(){return{ngModule:e,providers:[i.StompRService]}},e.decorators=[{type:r.NgModule,args:[{imports:[a.CommonModule,s.NotificationModule,c.ButtonsModule,u.InputsModule,l.DateInputsModule,p.FormsModule,g.DropDownsModule],providers:[i.StompRService]}]}],e}();e.EntriesParams=h,e.LogLevel=b,e.LogStatus=m,e.LoggerOperationResult=f,e.MonitorParams=d,e.TbLoggerModule=I,e.TbLoggerService=L,e.TbNotificationService=E,e.logger=y,e.prepareLog=S,Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=tb-logger.umd.min.js.map