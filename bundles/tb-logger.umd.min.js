!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@angular/core"),require("@angular/common/http"),require("rxjs"),require("rxjs/operators"),require("@stomp/ng2-stompjs"),require("@progress/kendo-angular-notification"),require("@angular/common"),require("@angular/forms"),require("@progress/kendo-angular-buttons"),require("@progress/kendo-angular-dropdowns"),require("@progress/kendo-angular-inputs"),require("@progress/kendo-angular-dateinputs")):"function"==typeof define&&define.amd?define("@tb/logger",["exports","@angular/core","@angular/common/http","rxjs","rxjs/operators","@stomp/ng2-stompjs","@progress/kendo-angular-notification","@angular/common","@angular/forms","@progress/kendo-angular-buttons","@progress/kendo-angular-dropdowns","@progress/kendo-angular-inputs","@progress/kendo-angular-dateinputs"],t):t(((e=e||self).tb=e.tb||{},e.tb.logger={}),e.ng.core,e.ng.common.http,e.rxjs,e.rxjs.operators,e.ng2Stompjs,e.kendoAngularNotification,e.ng.common,e.ng.forms,e.kendoAngularButtons,e.kendoAngularDropdowns,e.kendoAngularInputs,e.kendoAngularDateinputs)}(this,(function(e,t,r,o,n,i,s,a,p,c,g,u,l){"use strict";var h=function(e){this.instanceKey=e};var d=function(e,t,r){this.minutes="1",this.instanceKey=e,this.accountName=t,this.processName=r};var f=function(e,t){this.Result=e};var v=function(){this.DateTime=new Date,this.ProcessName="",this.ProcessId="",this.VirtualMemory=1e5,this.PhisicalMemory=1e5};var m,y={Info:0,Debug:1,Warn:2,Error:3,Fatal:4};y[y.Info]="Info",y[y.Debug]="Debug",y[y.Warn]="Warn",y[y.Error]="Error",y[y.Fatal]="Fatal";var S=function(){return m};var b={Trace:0,Debug:1,Warn:2,Error:3};function L(e,t){return void 0===t&&(t=b.Debug),{Message:e,Registeredappid:S().getAppId(),AccountName:localStorage.getItem("_accountname"),Subscription:localStorage.getItem("_company"),Category:"Client",Level:t}}b[b.Trace]="Trace",b[b.Debug]="Debug",b[b.Warn]="Warn",b[b.Error]="Error";var E=function(){function e(e,t,r,n){var s=this;this.env=e,this.http=t,this.stompService=r,this.ngZone=n,this.date=new Date,this.timeZoneOffSet=function(){return-s.date.getTimezoneOffset()/60},this.mqConnectionState=i.StompState.CLOSED,this.mqConnectionStateObservable=new o.BehaviorSubject(i.StompState.CLOSED),this._shouldLog=function(e){return e>=s.env.logger.level},this._serverLog=function(e,t){return s._shouldLog(e)&&s.sendLog(t,e)},m=this,this.loggerUrl=this.env.logger&&this.env.logger.url,this.serverMonitorUrl=this.env.serverMonitor&&this.env.serverMonitor.url,e.stompConfig&&this.mqInit()}return e.prototype.mqInit=function(){var e=this;this.env.stompConfig&&(this.stompService.config=this.env.stompConfig,this.stompService.initAndConnect(),this.stompService.state.subscribe((function(t){e.mqConnectionState=t,e.mqConnectionStateObservable.next(t)})))},e.prototype.getAppId=function(){return this.env.logger.appId},e.prototype.getLoggerUrl=function(){return this.loggerUrl?this.loggerUrl:this.env.logger.url},e.prototype.getLoggerPostUrl=function(){return this.getLoggerUrl()+"entries/"+this.getAppId()+"/"},e.prototype.getServerMonitorUrl=function(){return this.serverMonitorUrl?this.serverMonitorUrl:this.env.serverMonitor.url},e.prototype.sendLog=function(e,t){var r=this;this.ngZone.runOutsideAngular((function(){r.http.post(r.getLoggerPostUrl(),L(e,t)).toPromise().then((function(e){}),(function(e){return!0}))}))},e.prototype.log=function(e){this._shouldLog(b.Trace)&&console.log("%c"+e,"color:#3daf67"),this._serverLog(b.Trace,e)},e.prototype.debug=function(e){this._shouldLog(b.Debug)&&console.log("%c"+e,"color:#0277bd"),this._serverLog(b.Debug,e)},e.prototype.warn=function(e){this._shouldLog(b.Warn)&&console.log("%c"+e,"color:#FF9633"),this._serverLog(b.Warn,e)},e.prototype.error=function(e){this._shouldLog(b.Error)&&console.error("%c"+e,"color:red"),this._serverLog(b.Error,e)},e.prototype.stat=function(e){console.log("%c"+e,"color:#884EA0"),this._serverLog(b.Trace,e)},e.prototype.getLogs=function(e){if(!e.instanceKey){var t=new f(!1,"Error - No instanceKey, no party");return o.of(t)}var i=this.getLoggerUrl()+"entries/"+e.instanceKey,s=new r.HttpParams;e.howMany&&(s=s.append("howMany",e.howMany)),e.offSet&&(s=s.append("offSet",e.offSet)),e.accountName&&(s=s.append("accountName",e.accountName)),e.subscriptionKey&&(s=s.append("subscription",e.subscriptionKey)),e.category&&(s=s.append("categories",e.category)),e.apps&&(s=s.append("apps",e.apps)),e.appTypes&&(s=s.append("appTypes",e.appTypes)),e.levels&&(s=s.append("levels",e.levels)),e.rangeDateStart&&e.rangeDateEnd&&(s=(s=(e.rangeDateStart,e.rangeDateEnd,s.append("date",e.rangeDateStart+";"+e.rangeDateEnd))).append("timeZoneOffSet",this.timeZoneOffSet().toString()));var a={params:s};return this.http.get(i,a).pipe(n.catchError(this.handleError("TbLoggerService.getLogs",new f(!1,"Error - getLogs"))))},e.prototype.getApps=function(e){if(!e){var t=new f(!1,"Error - No appId, no party");return o.of(t)}var r=this.getLoggerUrl()+"apps/"+e;return this.http.get(r).pipe(n.catchError(this.handleError("TbLoggerService.getApps",new f(!1,"Error - getApps"))))},e.prototype.getAppTypes=function(e){if(!e){var t=new f(!1,"Error - No appId, no party");return o.of(t)}var r=this.getLoggerUrl()+"appTypes/"+e;return this.http.get(r).pipe(n.catchError(this.handleError("TbLoggerService.getAppTypes",new f(!1,"Error - getAppTypes"))))},e.prototype.getInstanceKey=function(){var e=this.getLoggerUrl()+"appIds";return this.http.get(e).pipe(n.catchError(this.handleError("TbLoggerService.getInstanceKey",new f(!1,"Error - getInstanceKey"))))},e.prototype.getSubscriptionKey=function(){var e=this.getLoggerUrl()+"subscriptionKeys";return this.http.get(e).pipe(n.catchError(this.handleError("TbLoggerService.getSubscriptionKey",new f(!1,"Error - getSubscriptionKey"))))},e.prototype.getCategories=function(e){if(!e){var t=new f(!1,"Error - No appId, no party");return o.of(t)}var r=this.getLoggerUrl()+"categories/"+e;return this.http.get(r).pipe(n.catchError(this.handleError("TbLoggerService.getCategories",new f(!1,"Error -  getCategories"))))},e.prototype.handleError=function(e,t){return void 0===e&&(e="operation"),function(r){return console.error(e+" failed: "+r.error),o.of(t)}},e.prototype.mqConnect=function(e){return this.stompService.subscribe(e).pipe(n.map((function(e){return JSON.parse(e.body)})))},e.prototype.mqConnected=function(){return this.stompService.connected()},e.prototype.mqDisconnect=function(){return this.stompService.disconnect()},e.prototype.getTBInfosLogs=function(e){var t=new r.HttpParams;e.accountName&&(t=t.append("accountName",""+e.accountName)),e.processName&&(t=t.append("processName",""+e.processName)),e.minutes&&(t=t.append("minute",""+e.minutes));var o={params:t},i=this.getServerMonitorUrl()+"tbServers/"+e.instanceKey;return this.http.get(i,o).pipe(n.catchError(this.handleError("TbLoggerService.getTBInfosLogs",[])))},e.decorators=[{type:t.Injectable,args:[{providedIn:"root"}]}],e.ctorParameters=function(){return[{type:void 0,decorators:[{type:t.Inject,args:["env"]}]},{type:r.HttpClient},{type:i.StompRService},{type:t.NgZone}]},e.ngInjectableDef=t.ɵɵdefineInjectable({factory:function(){return new e(t.ɵɵinject("env"),t.ɵɵinject(r.HttpClient),t.ɵɵinject(i.StompRService),t.ɵɵinject(t.NgZone))},token:e,providedIn:"root"}),e}();var I=function(){function e(e){this.notificationService=e}return e.prototype.show=function(e,t){void 0===t&&(t="none"),this.notificationService.show({content:e,animation:{type:"slide",duration:200},position:{horizontal:"right",vertical:"bottom"},type:{style:t,icon:!0},hideAfter:4e3})},e.decorators=[{type:t.Injectable,args:[{providedIn:"root"}]}],e.ctorParameters=function(){return[{type:s.NotificationService}]},e.ngInjectableDef=t.ɵɵdefineInjectable({factory:function(){return new e(t.ɵɵinject(s.NotificationService))},token:e,providedIn:"root"}),e}();var D=function(){function e(){}return e.forRoot=function(){return{ngModule:e,providers:[i.StompRService]}},e.decorators=[{type:t.NgModule,args:[{imports:[a.CommonModule,s.NotificationModule,c.ButtonsModule,u.InputsModule,l.DateInputsModule,p.FormsModule,g.DropDownsModule],providers:[i.StompRService]}]}],e}();e.EntriesParams=h,e.LogLevel=b,e.LogStatus=y,e.LoggerOperationResult=f,e.MonitorParams=d,e.TBServerInfo=v,e.TbLoggerModule=D,e.TbLoggerService=E,e.TbNotificationService=I,e.logger=S,e.prepareLog=L,Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=tb-logger.umd.min.js.map